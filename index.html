<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>RLC Bingo Manager</title>

    <!-- Cache control meta tags -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <!-- Styles -->
    <link rel="stylesheet" href="css/style.css?v=11.0.4">
    <link rel="stylesheet" href="css/wizard.css?v=11.0.4">
    <link rel="stylesheet" href="css/dark-mode.css?v=11.0.4">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Icons -->
    <link rel="icon" type="image/png" sizes="50x50" href="assets/icon-50.png">
    <link rel="apple-touch-icon" href="assets/icon-50.png">
</head>
<body>
    <div id="app">
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <h1>RLC Bingo Manager</h1>
                <div class="header-controls">
                    <button id="theme-toggle" class="icon-button" aria-label="Toggle theme">
                        <span class="theme-icon">üåô</span>
                    </button>
                    <button id="menu-toggle" class="icon-button" aria-label="Menu">
                        <span>‚ò∞</span>
                    </button>
                    <div class="connection-status">
                        <span id="status-indicator" class="status-online">‚óè</span>
                        <span id="status-text">Online</span>
                    </div>
                </div>
            </div>
        </header>
        
        <!-- Progress Bar -->
        <div class="wizard-progress">
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
            </div>
            <div class="progress-steps">
                <div class="step active" data-step="1">
                    <span class="step-number">1</span>
                    <span class="step-label">Session Info</span>
                </div>
                <div class="step" data-step="2">
                    <span class="step-number">2</span>
                    <span class="step-label">Paper Sales</span>
                </div>
                <div class="step" data-step="3">
                    <span class="step-number">3</span>
                    <span class="step-label">Game Results</span>
                </div>
                <div class="step" data-step="4">
                    <span class="step-number">4</span>
                    <span class="step-label">Pull-Tabs</span>
                </div>
                <div class="step" data-step="5">
                    <span class="step-number">5</span>
                    <span class="step-label">Money Count</span>
                </div>
                <div class="step" data-step="6">
                    <span class="step-number">6</span>
                    <span class="step-label">Review</span>
                </div>
            </div>
        </div>
        
        <!-- Main Content -->
        <main class="wizard-container">
            <!-- Step 1: Session Information -->
            <div class="wizard-step active" id="step-1">
                <h2>Session Information</h2>
                <div class="form-section">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="session-date">Date</label>
                            <input type="date" id="session-date" required>
                        </div>
                        <div class="form-group">
                            <label for="session-type">Session</label>
                            <select id="session-type" required>
                                <option value="">Select...</option>
                                <option value="5-1">5-1 (1st/5th Monday)</option>
                                <option value="6-2">6-2 (2nd Monday)</option>
                                <option value="7-3">7-3 (3rd Monday)</option>
                                <option value="8-4">8-4 (4th Monday)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="lion-charge">Lion in Charge</label>
                            <input type="text" id="lion-charge" required>
                        </div>
                        <div class="form-group">
                            <label for="total-people">Total People</label>
                            <input type="number" id="total-people" min="0" required>
                        </div>
                        <div class="form-group">
                            <label for="birthdays">Birthdays (BOGOs)</label>
                            <input type="number" id="birthdays" min="0" value="0">
                        </div>
                    </div>
                    
                    <div class="progressive-section">
                        <h3>Progressive Game</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="prog-jackpot">Jackpot Offered</label>
                                <input type="number" id="prog-jackpot" step="1" min="0">
                            </div>
                            <div class="form-group">
                                <label for="prog-balls">Balls to Win</label>
                                <input type="number" id="prog-balls" min="1" max="75">
                            </div>
                            <div class="form-group">
                                <label for="prog-consolation">Consolation Prize</label>
                                <input type="number" id="prog-consolation" value="200">
                            </div>
                            <div class="form-group">
                                <label for="prog-actual-balls">Actual Balls Called</label>
                                <input type="number" id="prog-actual-balls" min="1" max="75">
                            </div>
                            <div class="form-group">
                                <label for="prog-prize">Prize Awarded</label>
                                <input type="number" id="prog-prize" readonly>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="prog-check">
                                    Paid by Check
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Step 2: Paper Bingo Sales -->
            <div class="wizard-step" id="step-2">
                <h2>Paper Bingo Sales</h2>
                <div class="form-section">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Type</th>
                                <th>Start</th>
                                <th>Free</th>
                                <th>End</th>
                                <th>Sold</th>
                            </tr>
                        </thead>
                        <tbody id="paper-sales-body">
                            <!-- Rows will be generated by JavaScript -->
                        </tbody>
                    </table>
                    
                    <h3>POS Door Sales</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Item</th>
                                <th>Price</th>
                                <th>Quantity</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody id="pos-sales-body">
                            <!-- Rows will be generated by JavaScript -->
                        </tbody>
                        <tfoot>
                            <tr class="total-row">
                                <td colspan="3">Total Paper Sales</td>
                                <td id="total-paper-sales">$0.00</td>
                            </tr>
                        </tfoot>
                    </table>
                    
                    <h3>Electronic Bingo</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="small-machines">Small Machines (27reg/18pro) @ $40</label>
                            <input type="number" id="small-machines" min="0" value="0">
                        </div>
                        <div class="form-group">
                            <label for="large-machines">Large Machines (45reg/36pro) @ $65</label>
                            <input type="number" id="large-machines" min="0" value="0">
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Step 3: Game Results -->
            <div class="wizard-step" id="step-3">
                <h2>Session Games</h2>
                <div class="form-section">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Color</th>
                                <th>Game</th>
                                <th>Prize</th>
                                <th>Winners</th>
                                <th>Per Winner</th>
                                <th>Total</th>
                                <th>Check</th>
                            </tr>
                        </thead>
                        <tbody id="games-body">
                            <!-- Games will be loaded based on session -->
                        </tbody>
                        <tfoot>
                            <tr class="total-row">
                                <td colspan="6">Total Bingo Prizes</td>
                                <td id="total-bingo-prizes">$0.00</td>
                                <td></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
            
            <!-- Step 4: Pull-Tab Summary -->
            <div class="wizard-step" id="step-4">
                <h2>Pull-Tab Summary</h2>
                <div class="form-section">
                    <div class="form-group">
                        <label for="pt-lion">Lion in Charge of Pull-Tabs</label>
                        <input type="text" id="pt-lion">
                    </div>
                    
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Game</th>
                                <th>Serial #</th>
                                <th>$/Ticket</th>
                                <th>Tickets</th>
                                <th>Sales</th>
                                <th>Ideal</th>
                                <th>Prizes</th>
                                <th>Net</th>
                                <th>SE</th>
                                <th>Check</th>
                            </tr>
                        </thead>
                        <tbody id="pulltab-body">
                            <!-- Pull-tab games will be added here -->
                        </tbody>
                        <tfoot>
                            <tr class="total-row">
                                <td colspan="4">Regular Games</td>
                                <td id="pt-reg-sales">$0.00</td>
                                <td id="pt-reg-ideal">$0.00</td>
                                <td id="pt-reg-prizes">$0.00</td>
                                <td id="pt-reg-net">$0.00</td>
                                <td colspan="2"></td>
                            </tr>
                            <tr class="total-row special-event">
                                <td colspan="4">Special Events</td>
                                <td id="pt-se-sales">$0.00</td>
                                <td id="pt-se-ideal">$0.00</td>
                                <td id="pt-se-prizes">$0.00</td>
                                <td id="pt-se-net">$0.00</td>
                                <td colspan="2"></td>
                            </tr>
                        </tfoot>
                    </table>
                    
                    <button class="button secondary" onclick="addPullTabRow()">Add Game</button>
                    <button onclick="addSpecialEventRow()" class="button secondary">Add Special Event</button>
                </div>
            </div>
            
            <!-- Step 5: Money Count -->
            <div class="wizard-step" id="step-5">
                <h2>Money Summary</h2>
                <div class="form-section">
                    <div class="money-grid">
                        <div class="drawer-section">
                            <h3>Bingo Drawer</h3>
                            <table class="money-table">
                                <tr>
                                    <td>$100's</td>
                                    <td><input type="number" id="bingo-100" step="100" min="0"></td>
                                </tr>
                                <tr>
                                    <td>$50's</td>
                                    <td><input type="number" id="bingo-50" step="50" min="0"></td>
                                </tr>
                                <tr>
                                    <td>$20's</td>
                                    <td><input type="number" id="bingo-20" step="20" min="0"></td>
                                </tr>
                                <tr>
                                    <td>$10's</td>
                                    <td><input type="number" id="bingo-10" step="10" min="0"></td>
                                </tr>
                                <tr>
                                    <td>$5's</td>
                                    <td><input type="number" id="bingo-5" step="5" min="0"></td>
                                </tr>
                                <tr>
                                    <td>$2's</td>
                                    <td><input type="number" id="bingo-2" step="2" min="0"></td>
                                </tr>
                                <tr>
                                    <td>$1's</td>
                                    <td><input type="number" id="bingo-1" step="1" min="0"></td>
                                </tr>
                                <tr>
                                    <td>Coins</td>
                                    <td><input type="number" id="bingo-coins" step="0.01" min="0"></td>
                                </tr>
                                <tr>
                                    <td>Checks</td>
                                    <td><input type="number" id="bingo-checks" step="0.01" min="0"></td>
                                </tr>
                                <tr class="total-row">
                                    <td>Total</td>
                                    <td id="bingo-total">$0.00</td>
                                </tr>
                            </table>
                        </div>
                        
                        <div class="drawer-section">
                            <h3>Pull-Tab Drawer</h3>
                            <table class="money-table">
                                <tr>
                                    <td>$100's</td>
                                    <td><input type="number" id="pt-100" step="100" min="0"></td>
                                </tr>
                                <tr>
                                    <td>$50's</td>
                                    <td><input type="number" id="pt-50" step="50" min="0"></td>
                                </tr>
                                <tr>
                                    <td>$20's</td>
                                    <td><input type="number" id="pt-20" step="20" min="0"></td>
                                </tr>
                                <tr>
                                    <td>$10's</td>
                                    <td><input type="number" id="pt-10" step="10" min="0"></td>
                                </tr>
                                <tr>
                                    <td>$5's</td>
                                    <td><input type="number" id="pt-5" step="5" min="0"></td>
                                </tr>
                                <tr>
                                    <td>$2's</td>
                                    <td><input type="number" id="pt-2" step="2" min="0"></td>
                                </tr>
                                <tr>
                                    <td>$1's</td>
                                    <td><input type="number" id="pt-1" step="1" min="0"></td>
                                </tr>
                                <tr>
                                    <td>Coins</td>
                                    <td><input type="number" id="pt-coins" step="0.01" min="0"></td>
                                </tr>
                                <tr>
                                    <td>Checks</td>
                                    <td>N/A</td>
                                </tr>
                                <tr class="total-row">
                                    <td>Total</td>
                                    <td id="pt-total">$0.00</td>
                                </tr>
                            </table>
                        </div>
                        
                        <div class="drawer-section">
                            <h3>Deposit Summary</h3>
                            <table class="money-table">
                                <tr>
                                    <td>Currency</td>
                                    <td id="deposit-currency">$0.00</td>
                                </tr>
                                <tr>
                                    <td>Coins</td>
                                    <td id="deposit-coins">$0.00</td>
                                </tr>
                                <tr>
                                    <td>Checks</td>
                                    <td id="deposit-checks">$0.00</td>
                                </tr>
                                <tr class="total-row">
                                    <td>Total Deposit</td>
                                    <td id="deposit-total">$0.00</td>
                                </tr>
                                <tr>
                                    <td>Less Startup</td>
                                    <td>-$1,000.00</td>
                                </tr>
                                <tr class="grand-total">
                                    <td>Net Deposit</td>
                                    <td id="net-deposit">$0.00</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Step 6: Review and Submit -->
            <div class="wizard-step" id="step-6">
                <h2>Review & Submit</h2>
                <div class="form-section">
                    <div class="summary-card">
                        <h3>Financial Summary</h3>
                        <div class="summary-grid">
                            <div class="summary-item">
                                <label>Total Bingo Sales:</label>
                                <span id="summary-bingo-sales">$0.00</span>
                            </div>
                            <div class="summary-item">
                                <label>Pull-Tab Sales:</label>
                                <span id="summary-pt-sales">$0.00</span>
                            </div>
                            <div class="summary-item">
                                <label>Special Event Sales:</label>
                                <span id="summary-se-sales">$0.00</span>
                            </div>
                            <div class="summary-item grand-total">
                                <label>Gross Sales:</label>
                                <span id="summary-gross">$0.00</span>
                            </div>
                            <div class="summary-item">
                                <label>Bingo Prizes:</label>
                                <span id="summary-bingo-prizes">$0.00</span>
                            </div>
                            <div class="summary-item">
                                <label>Pull-Tab Prizes:</label>
                                <span id="summary-pt-prizes">$0.00</span>
                            </div>
                            <div class="summary-item">
                                <label>Special Event Prizes:</label>
                                <span id="summary-se-prizes">$0.00</span>
                            </div>
                            <div class="summary-item grand-total">
                                <label>Total Prizes:</label>
                                <span id="summary-total-prizes">$0.00</span>
                            </div>
                            <div class="summary-item">
                                <label>Cash Deposit:</label>
                                <span id="summary-deposit">$0.00</span>
                            </div>
                            <div class="summary-item">
                                <label>Less Startup:</label>
                                <span>-$1,000.00</span>
                            </div>
                            <div class="summary-item grand-total">
                                <label>Actual Profit:</label>
                                <span id="summary-actual">$0.00</span>
                            </div>
                            <div class="summary-item">
                                <label>Ideal Profit:</label>
                                <span id="summary-ideal">$0.00</span>
                            </div>
                            <div class="summary-item" id="overshort-item">
                                <label>Over/Short:</label>
                                <span id="summary-overshort">$0.00</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="metrics-card">
                        <h3>Performance Metrics</h3>
                        <div class="metrics-grid">
                            <div class="metric">
                                <span class="metric-value" id="metric-players">0</span>
                                <span class="metric-label">Total Players</span>
                            </div>
                            <div class="metric">
                                <span class="metric-value" id="metric-gross">$0.00</span>
                                <span class="metric-label">Gross Sales</span>
                            </div>
                            <div class="metric">
                                <span class="metric-value" id="metric-profit">$0.00</span>
                                <span class="metric-label">Net Profit</span>
                            </div>
                            <div class="metric">
                                <span class="metric-value" id="metric-per-player">$0.00</span>
                                <span class="metric-label">Per Player</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="action-buttons">
                        <button class="button success large" onclick="submitOccasion()">
                            Submit Occasion
                        </button>
                        <button class="button secondary" onclick="saveDraft()">
                            Save Draft
                        </button>
                        <button class="button" onclick="printReport()">
                            Print Report
                        </button>
                        <button class="button" onclick="exportData()">
                            Export Data
                        </button>
                    </div>
                </div>
            </div>
        </main>
        
        <!-- Navigation -->
        <div class="wizard-navigation">
            <button class="button secondary" id="prev-btn" onclick="prevStep()" disabled>
                Previous
            </button>
            <button class="button primary" id="next-btn" onclick="nextStep()">
                Next
            </button>
        </div>
        
        <!-- Side Menu -->
        <div class="side-menu" id="side-menu">
            <div class="menu-header">
                <h3>Menu</h3>
                <button class="close-menu" onclick="closeMenu()">√ó</button>
            </div>
            <nav class="menu-nav">
                <a href="#" onclick="showOccasions()">View Occasions</a>
                <a href="#" onclick="showReports()">Reports</a>
                <a href="#" onclick="showPullTabLibrary()">Pull-Tab Library</a>
                <a href="#admin" onclick="showAdmin()">Admin</a>
                <a href="#" onclick="showHelp()">Help</a>
            </nav>
        </div>
        
        <!-- Overlay -->
        <div class="overlay" id="overlay" onclick="closeMenu()"></div>
    </div>
    
    <!-- Scripts -->
    <script src="js/config.js?v=11.0.4"></script>
    <script src="js/app.js?v=11.0.4"></script>
    <script src="js/wizard.js?v=11.0.4"></script>
    <script src="js/calculations.js?v=11.0.4"></script>
    <script src="js/offline.js?v=11.0.4"></script>
    <script src="js/sync.js?v=11.0.4"></script>
    <script>
    // Force display of step 1
    window.addEventListener('load', function() {
        // Reset to step 1
        if (window.app) {
            window.app.currentStep = 1;
        }
        
        // Show step 1 content
        const allSteps = document.querySelectorAll('.wizard-step');
        console.log('Found', allSteps.length, 'wizard steps');
        
        allSteps.forEach(step => step.style.display = 'none');
        
        const step1 = document.getElementById('step-1');
        if (step1) {
            step1.style.display = 'block';
            step1.classList.add('active');
        } else {
            console.error('CRITICAL: No step-1 element found!');
        }
    });
    </script>
    <!-- Add this script block to the very bottom of your index.html file, right before </body> -->
    <script>
    // Critical UI Fixes v11.0.4
    (function() {
        console.log('Applying critical UI fixes...');
        
        // 1. FIX HEADER NAVIGATION - Move Next button to proper location
        const headerNext = document.querySelector('header .button, header button');
        if (headerNext && headerNext.textContent.includes('Next')) {
            headerNext.style.display = 'none';
            console.log('Hidden misplaced header Next button');
        }
        
        // Ensure hamburger menu is visible
        const menuToggle = document.getElementById('menu-toggle');
        if (menuToggle) {
            menuToggle.style.display = 'block';
            menuToggle.innerHTML = '‚ò∞';
        }
        
        // Ensure theme toggle is visible
        const themeToggle = document.getElementById('theme-toggle');
        if (themeToggle) {
            themeToggle.style.display = 'block';
            themeToggle.innerHTML = localStorage.getItem('theme') === 'dark' ? '‚òÄÔ∏è' : 'üåô';
            themeToggle.onclick = function() {
                document.body.classList.toggle('dark-mode');
                const isDark = document.body.classList.contains('dark-mode');
                localStorage.setItem('theme', isDark ? 'dark' : 'light');
                themeToggle.innerHTML = isDark ? '‚òÄÔ∏è' : 'üåô';
            };
        }
        
        // 2. FIX PROGRESSIVE PRIZE CALCULATION
        function calculateProgressivePrize() {
            const jackpot = parseFloat(document.getElementById('prog-jackpot')?.value) || 0;
            const ballsNeeded = parseInt(document.getElementById('prog-balls')?.value) || 0;
            const actualBalls = parseInt(document.getElementById('prog-actual-balls')?.value) || 0;
            const consolation = parseFloat(document.getElementById('prog-consolation')?.value) || 200;
            
            let prize = 0;
            if (actualBalls > 0 && ballsNeeded > 0) {
                prize = actualBalls <= ballsNeeded ? jackpot : consolation;
            }
            
            const prizeField = document.getElementById('prog-prize');
            if (prizeField) {
                prizeField.value = prize;
                prizeField.removeAttribute('readonly'); // Allow manual override if needed
            }
            
            console.log('Progressive calculated:', { jackpot, ballsNeeded, actualBalls, prize });
        }
        
        // Add event listener for progressive calculation
        const progActualBalls = document.getElementById('prog-actual-balls');
        if (progActualBalls) {
            progActualBalls.addEventListener('input', calculateProgressivePrize);
        }
        
        // Make Prize Awarded field editable
        const progPrize = document.getElementById('prog-prize');
        if (progPrize) {
            progPrize.removeAttribute('readonly');
            progPrize.type = 'number';
            progPrize.step = '0.01';
            progPrize.min = '0';
        }
        
        // 3. FIX NAVIGATION BUTTONS
        window.app = window.app || {
            currentStep: 1,
            totalSteps: 6,
            data: {
                occasion: {},
                paperBingo: {},
                posSales: {},
                electronic: {},
                games: [],
                pullTabs: [],
                moneyCount: { bingo: {}, pullTab: {} },
                financial: {}
            }
        };
        
        // Get the actual navigation buttons (at bottom of form)
        function fixNavigationButtons() {
            // Find buttons in the wizard navigation area, not header
            const wizardNav = document.querySelector('.wizard-navigation') || 
                             document.querySelector('.step-navigation') ||
                             document.querySelector('main');
            
            if (!wizardNav) return;
            
            let prevBtn = wizardNav.querySelector('button:first-of-type[onclick*="previous"]') ||
                          wizardNav.querySelector('.button.secondary');
            let nextBtn = wizardNav.querySelector('button:last-of-type[onclick*="next"]') ||
                          wizardNav.querySelector('.button.primary:not(header *)');
            
            // Create navigation container if buttons don't exist
            if (!prevBtn || !nextBtn) {
                const navContainer = document.createElement('div');
                navContainer.className = 'wizard-navigation';
                navContainer.style.cssText = 'display: flex; justify-content: space-between; margin-top: 20px;';
                
                prevBtn = document.createElement('button');
                prevBtn.className = 'button secondary';
                prevBtn.textContent = 'Previous';
                
                nextBtn = document.createElement('button');
                nextBtn.className = 'button primary';
                nextBtn.textContent = 'Next';
                
                navContainer.appendChild(prevBtn);
                navContainer.appendChild(nextBtn);
                
                // Add to the current step content
                const currentStep = document.getElementById(`step-${window.app.currentStep}`);
                if (currentStep) {
                    currentStep.appendChild(navContainer);
                }
            }
            
            // Update button states
            if (prevBtn) {
                prevBtn.style.display = window.app.currentStep === 1 ? 'none' : 'inline-block';
                prevBtn.onclick = function() {
                    if (window.app.currentStep > 1) {
                        saveCurrentStepData();
                        window.app.currentStep--;
                        showStep(window.app.currentStep);
                    }
                };
            }
            
            if (nextBtn) {
                nextBtn.textContent = window.app.currentStep === 6 ? 'Complete' : 'Next';
                nextBtn.onclick = function() {
                    // Validate current step
                    if (validateCurrentStep()) {
                        saveCurrentStepData();
                        if (window.app.currentStep < 6) {
                            window.app.currentStep++;
                            showStep(window.app.currentStep);
                        } else {
                            // Submit
                            alert('Ready to submit! (Implementation needed)');
                        }
                    }
                };
            }
        }
        
        // Validation function
        function validateCurrentStep() {
            if (window.app.currentStep === 1) {
                const required = ['session-date', 'session-type', 'lion-charge', 'total-people'];
                for (let fieldId of required) {
                    const field = document.getElementById(fieldId);
                    if (!field || !field.value) {
                        alert(`Please fill in: ${fieldId.replace('-', ' ').replace('lion charge', 'Lion in Charge')}`);
                        field?.focus();
                        return false;
                    }
                }
            }
            return true;
        }
        
        // Save current step data
        function saveCurrentStepData() {
            if (window.app.currentStep === 1) {
                window.app.data.occasion = {
                    date: document.getElementById('session-date')?.value,
                    sessionType: document.getElementById('session-type')?.value,
                    lionInCharge: document.getElementById('lion-charge')?.value,
                    totalPeople: document.getElementById('total-people')?.value,
                    birthdays: document.getElementById('birthdays')?.value || 0,
                    progressive: {
                        jackpot: document.getElementById('prog-jackpot')?.value,
                        ballsNeeded: document.getElementById('prog-balls')?.value,
                        actualBalls: document.getElementById('prog-actual-balls')?.value,
                        consolation: document.getElementById('prog-consolation')?.value,
                        prize: document.getElementById('prog-prize')?.value,
                        paidByCheck: document.getElementById('prog-check')?.checked
                    }
                };
            }
        }
        
        // Show specific step
        function showStep(stepNum) {
            console.log('Showing step:', stepNum);
            
            // Hide all steps
            for (let i = 1; i <= 6; i++) {
                const step = document.getElementById(`step-${i}`);
                if (step) {
                    step.style.display = 'none';
                    step.classList.remove('active');
                }
            }
            
            // Show current step
            const currentStep = document.getElementById(`step-${stepNum}`);
            if (currentStep) {
                currentStep.style.display = 'block';
                currentStep.classList.add('active');
            }
            
            // Update step indicators
            document.querySelectorAll('.step').forEach((indicator, index) => {
                indicator.classList.remove('active', 'completed');
                if (index + 1 === stepNum) {
                    indicator.classList.add('active');
                } else if (index + 1 < stepNum) {
                    indicator.classList.add('completed');
                }
            });
            
            // Fix navigation buttons for this step
            fixNavigationButtons();
        }
        
        // 4. BIRTHDAY BOGO CALCULATION
        const birthdayInput = document.getElementById('birthdays');
        if (birthdayInput) {
            birthdayInput.addEventListener('input', function() {
                const count = parseInt(this.value) || 0;
                console.log('Birthday BOGO count:', count);
                // This would trigger free paper calculations
                // Implementation depends on your paper sales setup
            });
        }
        
        // Apply initial fixes
        setTimeout(() => {
            fixNavigationButtons();
            showStep(1);
            console.log('Critical UI fixes applied');
        }, 100);
        
    })();
    </script>
    
    <!-- ADD THIS CSS TO FIX LAYOUT ISSUES -->
    <style>
    /* Fix navigation button positioning */
    .wizard-navigation {
        display: flex;
        justify-content: space-between;
        margin-top: 30px;
        padding: 20px 0;
        border-top: 1px solid #ddd;
    }
    
    /* Ensure header buttons don't interfere */
    header button.primary {
        display: none !important;
    }
    
    /* Fix step content display */
    .wizard-step {
        min-height: 400px;
    }
    
    /* Dark mode fixes */
    .dark-mode .wizard-navigation {
        border-top-color: #444;
    }
    
    /* Progressive section styling */
    .progressive-section input[type="number"] {
        background: white;
        border: 1px solid #ccc;
        padding: 8px;
        border-radius: 4px;
    }
    
    .dark-mode .progressive-section input[type="number"] {
        background: #2a2a2a;
        color: white;
        border-color: #555;
    }
    </style>
</body>
</html>
