<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RLC Bingo Mobile v12.0</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #f5f5f5; }

        .mobile-container { max-width: 480px; margin: 0 auto; background: white; min-height: 100vh; }
        .mobile-header { background: #1976d2; color: white; padding: 15px; text-align: center; }
        .mobile-content { padding: 20px; }

        .occasion-info { background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .occasion-info h3 { margin-bottom: 10px; color: #1976d2; }
        .occasion-info p { margin: 5px 0; font-size: 14px; }

        .section { margin-bottom: 30px; }
        .section h2 { color: #333; margin-bottom: 15px; font-size: 18px; border-bottom: 2px solid #1976d2; padding-bottom: 5px; }

        .game-list { display: grid; gap: 10px; }
        .game-item { background: white; border: 1px solid #ddd; border-radius: 8px; padding: 15px; }
        .game-item h3 { color: #1976d2; margin-bottom: 8px; font-size: 16px; }
        .game-item p { margin: 3px 0; font-size: 14px; color: #666; }
        .game-item .prize { font-weight: bold; color: #4caf50; font-size: 16px; }

        .btn { padding: 12px 20px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; width: 100%; margin: 10px 0; }
        .btn-primary { background: #1976d2; color: white; }
        .btn-success { background: #4caf50; color: white; }

        .loading { text-align: center; padding: 40px; color: #666; }
        .error { background: #ffebee; border: 1px solid #f44336; color: #c62828; padding: 15px; margin: 10px 0; border-radius: 4px; }

        @media (max-width: 480px) {
            .mobile-content { padding: 15px; }
        }
    </style>
</head>
<body>
    <div class="mobile-container">
        <div class="mobile-header">
            <h1>RLC Bingo Mobile</h1>
            <p>Game Manager v12.0</p>
        </div>

        <div class="mobile-content">
            <div id="occasion-selector" class="section">
                <h2>Select Occasion</h2>
                <select id="occasion-select" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 10px;">
                    <option value="">Loading occasions...</option>
                </select>
                <button class="btn btn-primary" onclick="loadSelectedOccasion()">Load Occasion</button>
            </div>

            <div id="occasion-display" style="display: none;">
                <div id="occasion-info" class="occasion-info">
                    <!-- Occasion details will be loaded here -->
                </div>

                <div class="section">
                    <h2>Session Games</h2>
                    <div id="games-list" class="game-list">
                        <!-- Games will be loaded here -->
                    </div>
                </div>

                <div class="section">
                    <h2>Actions</h2>
                    <button class="btn btn-success" onclick="window.location.href='rlcbingo_fe_admin.html'">
                        Back to Admin
                    </button>
                </div>
            </div>

            <div id="loading" class="loading" style="display: none;">
                Loading...
            </div>
        </div>
    </div>

    <!-- Load JavaScript files -->
    <script src="rlcbingo_fe_config.js"></script>
    <script src="rlcbingo_fe_auth.js"></script>
    <script src="rlcbingo_fe_app.js"></script>

    <script>
        let currentOccasion = null;
        let sessionGames = [];

        document.addEventListener('DOMContentLoaded', async () => {
            await loadOccasionsList();
        });

        async function loadOccasionsList() {
            try {
                const result = await RLCBingo.loadOccasions();

                const select = document.getElementById('occasion-select');

                if (result.success && result.occasions.length > 0) {
                    select.innerHTML = '<option value="">Select an occasion...</option>';

                    result.occasions.forEach(occasion => {
                        const option = document.createElement('option');
                        option.value = occasion.id;
                        option.textContent = `${formatDate(occasion.date)} - ${occasion.sessionType} - ${occasion.lionInCharge}`;
                        select.appendChild(option);
                    });
                } else {
                    select.innerHTML = '<option value="">No occasions available</option>';
                }
            } catch (error) {
                document.getElementById('occasion-select').innerHTML = '<option value="">Error loading occasions</option>';
                console.error('Error loading occasions:', error);
            }
        }

        async function loadSelectedOccasion() {
            const occasionId = document.getElementById('occasion-select').value;

            if (!occasionId) {
                alert('Please select an occasion');
                return;
            }

            showLoading(true);

            try {
                // Load occasion data
                const occasionResult = await RLCBingo.loadOccasion(occasionId);

                if (!occasionResult.success) {
                    throw new Error(occasionResult.error);
                }

                currentOccasion = occasionResult.data;

                // Load session games based on session type
                await loadSessionGames(currentOccasion.sessionType);

                displayOccasion();

                document.getElementById('occasion-selector').style.display = 'none';
                document.getElementById('occasion-display').style.display = 'block';

            } catch (error) {
                alert('Error loading occasion: ' + error.message);
                console.error('Error:', error);
            } finally {
                showLoading(false);
            }
        }

        async function loadSessionGames(sessionType) {
            // For now, use default games since we haven't implemented session-games endpoint in GitHub Actions
            sessionGames = getDefaultSessionGames(sessionType || '5-1');
        }

        function getDefaultSessionGames(sessionType) {
            const games = {
                '5-1': [
                    {num: 1, color: 'Early Bird', game: 'Hard Way Bingo No Free Space', prize: 100},
                    {num: 2, color: 'Early Bird', game: 'Diagonal & Outside Corners', prize: 100},
                    {num: 3, color: 'Early Bird', game: 'Small Picture Frame', prize: 100},
                    {num: 4, color: 'Blue', game: 'Regular Bingo or Outside 4 Corners', prize: 100},
                    {num: 5, color: 'Orange', game: '$250 Number 7', prize: 250},
                    {num: 6, color: 'Green', game: 'Small Diamond', prize: 100},
                    {num: 7, color: 'Yellow', game: 'Crazy Picture Frame', prize: 100},
                    {num: 8, color: 'Pink', game: '$250 Letter X', prize: 250},
                    {num: 10, color: 'Gray', game: 'Baseball Diamond', prize: 150},
                    {num: 11, color: 'Olive', game: '6 Pack Anywhere', prize: 150},
                    {num: 12, color: 'Brown', game: 'Top or Bottom Line', prize: 150},
                    {num: 13, color: 'Progressive', game: 'Diamond', prize: 0, progressive: true},
                    {num: 14, color: 'Red', game: '3 on Top Row and 3 on Bottom Row', prize: 150},
                    {num: 15, color: 'Purple', game: 'Double Postage Stamp - Anywhere', prize: 150},
                    {num: 16, color: 'Black', game: 'Small Kite', prize: 150},
                    {num: 17, color: 'Aqua', game: '$500 Coverall', prize: 500}
                ]
            };

            return games[sessionType] || games['5-1'];
        }

        function displayOccasion() {
            // Display occasion info
            const infoDiv = document.getElementById('occasion-info');
            infoDiv.innerHTML = `
                <h3>${formatDate(currentOccasion.date)} - ${currentOccasion.sessionType}</h3>
                <p><strong>Lion in Charge:</strong> ${currentOccasion.lionInCharge}</p>
                <p><strong>Total Players:</strong> ${currentOccasion.totalPlayers || 0}</p>
                <p><strong>Status:</strong> ${currentOccasion.status || 'Active'}</p>
            `;

            // Display games
            const gamesDiv = document.getElementById('games-list');
            gamesDiv.innerHTML = sessionGames.map(game => `
                <div class="game-item">
                    <h3>Game ${game.num} - ${game.color}</h3>
                    <p>${game.game}</p>
                    <p class="prize">Prize: ${game.progressive ? 'Progressive' : '$' + game.prize}</p>
                </div>
            `).join('');
        }

        function formatDate(dateStr) {
            if (!dateStr) return 'N/A';
            try {
                const date = new Date(dateStr);
                return date.toLocaleDateString();
            } catch {
                return dateStr;
            }
        }

        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }
    </script>
</body>
</html>